<!-- Views/MainWindow.axaml -->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:FFGUITool.ViewModels"
        x:Class="FFGUITool.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding Title}"
        Width="900" Height="750"
        MinWidth="700" MinHeight="650">
    
    <Window.Styles>
        <!-- Remove ActualThemeVariant selectors and use dynamic resources -->
        <Style Selector="Border.info-card">
            <Setter Property="Background" Value="{DynamicResource CardBackground}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource CardBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Padding" Value="15"/>
        </Style>
        <Style Selector="Border.video-info">
            <Setter Property="Background" Value="{DynamicResource VideoInfoBackground}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource VideoInfoBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Padding" Value="15"/>
        </Style>
        <Style Selector="TextBox.command-box">
            <Setter Property="Background" Value="{DynamicResource CommandBoxBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource CommandBoxForeground}"/>
            <Setter Property="FontFamily" Value="Consolas, 'Courier New', monospace"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="IsReadOnly" Value="True"/>
        </Style>
        <Style Selector="TextBox.command-box:pointerover /template/ Border#PART_BorderElement">
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        <Style Selector="TextBox.command-box:focus /template/ Border#PART_BorderElement">
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </Window.Styles>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- èœå•æ  -->
        <Menu Grid.Row="0">
            <MenuItem Header="æ–‡ä»¶(_F)">
                <MenuItem Header="é€€å‡º(_X)" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="å·¥å…·(_T)">
                <MenuItem Header="FFmpegè®¾ç½®(_S)" Command="{Binding ShowFFmpegSettingsCommand}"/>
                <Separator/>
                <MenuItem Header="é‡æ–°æ£€æµ‹FFmpeg(_R)" Command="{Binding RedetectFFmpegCommand}"/>
            </MenuItem>
            <MenuItem Header="å¸®åŠ©(_H)">
                <MenuItem Header="å…³äºŽ(_A)" Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="120"/>
            </Grid.RowDefinitions>

            <!-- é¡¶éƒ¨æ ‡é¢˜å’Œä¸»é¢˜åˆ‡æ¢ -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- ä¸­é—´æ ‡é¢˜åŒºåŸŸ -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="FFGUITool" FontSize="24" FontWeight="Bold"/>
                    <TextBlock Text="{Binding FfmpegStatusText}" 
                               FontSize="14" VerticalAlignment="Bottom" 
                               Margin="10,0,0,2" Foreground="{Binding FfmpegStatusColor}"/>
                </StackPanel>
                
                <!-- å³ä¾§ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
                <ToggleButton Grid.Column="2" 
                              IsChecked="{Binding IsThemeDark}"
                              HorizontalAlignment="Right"
                              Width="50" Height="30"
                              ToolTip.Tip="åˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜">
                    <Panel>
                        <TextBlock Text="ðŸŒ™" IsVisible="{Binding !IsThemeDark}"/>
                        <TextBlock Text="â˜€ï¸" IsVisible="{Binding IsThemeDark}"/>
                    </Panel>
                </ToggleButton>
            </Grid>

            <!-- ä¸»è¦æ“ä½œåŒºåŸŸ -->
            <ScrollViewer Grid.Row="1">
                <StackPanel Spacing="15">
                    
                    <!-- æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
                    <Border Classes="info-card" BorderThickness="1" CornerRadius="5" Padding="15">
                        <StackPanel Spacing="10">
                            <TextBlock Text="æ–‡ä»¶é€‰æ‹©" FontWeight="Bold" FontSize="16"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBox Grid.Column="0" 
                                         Text="{Binding InputPathText}"
                                         Watermark="é€‰æ‹©è§†é¢‘æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹..." 
                                         IsReadOnly="True"/>
                                <Button Grid.Column="1" Content="é€‰æ‹©æ–‡ä»¶" 
                                        Command="{Binding SelectFileCommand}"
                                        Margin="5,0,0,0"/>
                                <Button Grid.Column="2" Content="é€‰æ‹©æ–‡ä»¶å¤¹" 
                                        Command="{Binding SelectFolderCommand}"
                                        Margin="5,0,0,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- åŽŸè§†é¢‘ä¿¡æ¯æ˜¾ç¤º -->
                    <Border Classes="video-info" BorderThickness="1" CornerRadius="5" Padding="15"
                            IsVisible="{Binding IsVideoInfoVisible}">
                        <StackPanel Spacing="8" DataContext="{Binding CurrentVideoInfo}">
                            <TextBlock Text="åŽŸè§†é¢‘ä¿¡æ¯" FontWeight="Bold" FontSize="16"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="100"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto" MinWidth="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- ç¬¬ä¸€è¡Œ -->
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="æ–‡ä»¶å¤§å°:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding FormattedFileSize}" Margin="5,0,15,0"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="æ—¶é•¿:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding FormattedDuration}" Margin="5,0,0,0"/>
                                
                                <!-- ç¬¬äºŒè¡Œ -->
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="åŽŸæ¯”ç‰¹çŽ‡:" FontWeight="SemiBold" Margin="0,5,0,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Bitrate, StringFormat='{}{0} kbps'}" Margin="5,5,15,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="åˆ†è¾¨çŽ‡:" FontWeight="SemiBold" Margin="0,5,0,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding Resolution}" Margin="5,5,0,0"/>
                                
                                <!-- ç¬¬ä¸‰è¡Œ -->
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="å¸§çŽ‡:" FontWeight="SemiBold" Margin="0,5,0,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Framerate, StringFormat='{}{0:F1} fps'}" Margin="5,5,15,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- åŽ‹ç¼©å‚æ•°è®¾ç½® -->
                    <Border Classes="info-card" BorderThickness="1" CornerRadius="5" Padding="15">
                        <StackPanel Spacing="12">
                            <TextBlock Text="åŽ‹ç¼©è®¾ç½®" FontWeight="Bold" FontSize="16"/>
                            
                            <!-- åŽ‹ç¼©ç™¾åˆ†æ¯”è¾“å…¥æ¡† -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="åŽ‹ç¼©çŽ‡:" VerticalAlignment="Center"/>
                                <NumericUpDown Grid.Column="1" 
                                               Value="{Binding CompressionPercentage}"
                                               Minimum="10" Maximum="100"
                                               Increment="1" FormatString="0"
                                               Margin="5,0,0,0" Height="32"/>
                                <TextBlock Grid.Column="2" Text="%" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                <TextBlock Grid.Column="3" Text="ï¼ˆæ•°å€¼è¶Šå°åŽ‹ç¼©è¶Šå¤šï¼‰" 
                                           VerticalAlignment="Center" Margin="15,0,0,0"
                                           Opacity="0.7" FontSize="12"/>
                            </Grid>

                            <!-- æ‰‹åŠ¨æ¯”ç‰¹çŽ‡æŽ§åˆ¶ -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- ç¬¬ä¸€è¡Œï¼šæ ‡ç­¾ -->
                                <TextBlock Grid.Row="0" Text="æ‰‹åŠ¨æ¯”ç‰¹çŽ‡:" Margin="0,0,0,8"/>
                                
                                <!-- ç¬¬äºŒè¡Œï¼šè¾“å…¥æ¡†ã€æ»‘åŠ¨æ¡å’Œæ˜¾ç¤ºå€¼ -->
                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*" MinWidth="200"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- æ‰‹åŠ¨è¾“å…¥æ¡† -->
                                    <NumericUpDown Grid.Column="0" 
                                                   Value="{Binding Bitrate}"
                                                   Minimum="1" Maximum="50000"
                                                   Increment="100" FormatString="0"
                                                   Height="32" Margin="0,0,10,0"/>
                                    
                                    <!-- æ»‘åŠ¨æ¡ -->
                                    <Slider Grid.Column="1" 
                                            Value="{Binding BitrateSliderValue}"
                                            Minimum="{Binding BitrateSliderMinimum}"
                                            Maximum="{Binding BitrateSliderMaximum}"
                                            TickFrequency="500" IsSnapToTickEnabled="False"
                                            Margin="0,0,10,0"/>
                                            
                                    <!-- æ˜¾ç¤ºå€¼ -->
                                    <TextBlock Grid.Column="2" 
                                               Text="{Binding BitrateValueText}"
                                               VerticalAlignment="Center" 
                                               TextAlignment="Right" FontWeight="SemiBold"/>
                                </Grid>
                            </Grid>

                            <!-- æ¯”ç‰¹çŽ‡è­¦å‘Šä¿¡æ¯ -->
                            <TextBlock Text="âš  è­¦å‘Šï¼šå½“å‰æ¯”ç‰¹çŽ‡é«˜äºŽåŽŸè§†é¢‘ï¼Œæ–‡ä»¶å¯èƒ½ä¼šå˜å¤§ï¼" 
                                       Foreground="Orange" FontWeight="Bold"
                                       FontSize="12" 
                                       IsVisible="{Binding IsBitrateWarningVisible}"
                                       Margin="0,5,0,0" TextWrapping="Wrap"/>

                            <!-- é¢„ä¼°ç»“æžœæ˜¾ç¤º -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="é¢„ä¼°ç»“æžœ:" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding EstimatedBitrateText}"
                                           Foreground="{Binding EstimatedBitrateColor, Converter={StaticResource StringToColorConverter}}"
                                           VerticalAlignment="Center"
                                           Margin="5,0,0,0" TextWrapping="Wrap"/>
                            </Grid>

                            <!-- ç¼–ç å™¨é€‰æ‹© -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="ç¼–ç å™¨:" VerticalAlignment="Center"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding CodecOptions}"
                                          SelectedItem="{Binding SelectedCodecOption}"
                                          DisplayMemberBinding="{Binding Name}"
                                          Margin="5,0,0,0" Height="32"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- è¾“å‡ºè®¾ç½® -->
                    <Border Classes="info-card" BorderThickness="1" CornerRadius="5" Padding="15">
                        <StackPanel Spacing="10">
                            <TextBlock Text="è¾“å‡ºè®¾ç½®" FontWeight="Bold" FontSize="16"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBox Grid.Column="0" 
                                         Text="{Binding OutputPathText}"
                                         Watermark="é€‰æ‹©è¾“å‡ºæ–‡ä»¶å¤¹..." 
                                         IsReadOnly="True"/>
                                <Button Grid.Column="1" Content="é€‰æ‹©è¾“å‡ºæ–‡ä»¶å¤¹" 
                                        Command="{Binding SelectOutputFolderCommand}"
                                        Margin="5,0,0,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </ScrollViewer>

            <!-- åˆ†éš”çº¿ -->
            <Border Grid.Row="2" Height="1" Opacity="0.3" 
                    Background="Gray" 
                    Margin="0,10"/>

            <!-- CLIå‘½ä»¤æ˜¾ç¤ºå’Œæ‰§è¡ŒåŒºåŸŸ -->
            <Grid Grid.Row="3">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="ç”Ÿæˆçš„FFmpegå‘½ä»¤:" 
                           FontWeight="Bold" Margin="0,0,0,5"/>
                
                <TextBox Grid.Row="1" 
                         Classes="command-box"
                         Text="{Binding CommandText}"
                         TextWrapping="Wrap"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         LineHeight="18"
                         Padding="8,6,8,4"/>
                
                <Grid Grid.Row="2" Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <ProgressBar Grid.Column="0" 
                                 Height="30" 
                                 IsVisible="{Binding IsProgressVisible}"
                                 IsIndeterminate="True"/>
                    <Button Grid.Column="1" Content="æ‰§è¡Œ" 
                            Command="{Binding ExecuteCommand}"
                            IsEnabled="{Binding CanExecute}"
                            Width="100" Height="30" Margin="10,0,0,0"
                            Background="#007ACC" Foreground="White" FontWeight="SemiBold"/>
                </Grid>
            </Grid>

        </Grid>
    </Grid>
</Window>